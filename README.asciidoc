# Unofficial Coherence 12.2.1 Learning Image

* Coherence 12.2.1 documentation:

http://docs.oracle.com/middleware/1221/coherence/index.html

* Coherence 12.2.1 examples are documented here:

http://docs.oracle.com/middleware/1221/coherence/install/examples.htm#COHIN1050

## Image content

* OL7 
* JDK 8
* Coherence 12.2.1
* Maven 3.3.3

## Common Instructions

### Build image

. Download JDK 8 and Coherence 12.2.1 packages from the locations defined in the ".download" files.
. Clone this workspace: `git clone https://github.com/jens18/docker-images.git`
. Build the image as `docker build -t java8_coh12 .`

### Run Coherence REST example
. Startup Coherence REST example:  `docker run -p 8080:8080 -v /tmp/.X11-unix/X0:/tmp/.X11-unix/X0 -i -t java8_coh12  /bin/bash /home/cgbu-dev/run_rest_example.sh`
. Access the Coherence REST example at http://127.0.0.1:8080/application/index.html

image::images/coh_rest_app.png[]

### Run Coherence federated caching example

* root passwd: cgbu-dev
* cgbu-dev passwd: cgbu-dev
* Startup container:   `docker run -v $XSOCK:$XSOCK -i -t java8_coh12  /bin/bash`

[source, text]
----
host: $ xhost +
container default terminal: xterm& # launch 4 xterm's (name: xterm[1-4])
container default terminal: jconsole&
container xterm 1: cd ~/opt/coh_12.2.1/coherence/examples/java; bin/run-cache-server federation ClusterA # datagrid A
container xterm 2: cd ~/opt/coh_12.2.1/coherence/examples/java; bin/run-cache-server federation ClusterB # datagrid B
container xterm 3: cd ~/opt/coh_12.2.1/coherence/examples/java; bin/run federation ClusterA # UI for datagrid A
container xterm 4: cd ~/opt/coh_12.2.1/coherence/examples/java; bin/run federation ClusterB # UI for datagrid B
----

image::images/coh_federated_caching.png[]

### Run Coherence

* Start default Coherence datagrid with 2 nodes
* One node runs the interactive Coherence console

[source, text]
----
host: $ xhost +
container default terminal: xterm& # to launch the first Coherence node (name: xterm1)
container default terminal: xterm& # to launch the second Coherence node (name: xterm2)
container default terminal: jconsole&
container xterm 1: cd ~/opt/coh_12.2.1/coherence/bin; ./cache-server.sh
container xterm 2: cd ~/opt/coh_12.2.1/coherence/bin; ./coherence.sh
container xterm 2: cache test
container xterm 2: put key1 jens
container xterm 2: get key1
----

### HTTP proxy configuration

The following configuration files have to be changed if your environment requires the use of a HTTP proxy:

Note: HTTP proxy settings are by default commented out. Search for the string "www-proxy.us.oracle.com".

. Host Docker service: /etc/default/docker (requires restart of Docker service: `service docker restart`)
. Container Maven: settings.xml
. Container OL7 Yum: Dockerfile
. Container Curl: Dockerfile



